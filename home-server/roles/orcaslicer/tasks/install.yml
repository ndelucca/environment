---
# Install Podman and dependencies for OrcaSlicer

- name: Install Podman packages
  ansible.builtin.dnf:
    name:
      - podman
      - slirp4netns
      - fuse-overlayfs
      - crun
    state: present
  become: true

- name: Verify Podman installation
  ansible.builtin.command: podman --version
  register: podman_version
  changed_when: false

- name: Display Podman version
  ansible.builtin.debug:
    msg: "Installed {{ podman_version.stdout }}"

- name: Check Podman version is >= 4.4 (required for Quadlet)
  ansible.builtin.assert:
    that:
      - podman_version.stdout is version('podman version 4.4', '>=', version_type='loose')
    fail_msg: "Podman 4.4+ is required for Quadlet support"
    success_msg: "Podman version is compatible with Quadlet"
  when: podman_version.stdout is defined

- name: Enable lingering for user (allows user services without login)
  ansible.builtin.command: loginctl enable-linger {{ orcaslicer_user }}
  become: true
  changed_when: false

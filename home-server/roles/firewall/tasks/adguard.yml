---
# Configure firewall for AdGuard Home

- name: Configure firewall ports for AdGuard Home
  ansible.posix.firewalld:
    port: "{{ item }}"
    zone: "{{ adguard_firewall_zone }}"
    permanent: true
    immediate: true
    state: enabled
  become: true
  loop:
    - "{{ adguard_bind_port }}/tcp"        # Web UI initial setup
    - "{{ adguard_admin_port }}/tcp"       # Web UI admin
    - "{{ adguard_dns_port }}/tcp"         # DNS TCP
    - "{{ adguard_dns_port }}/udp"         # DNS UDP
    - "{{ adguard_dns_over_tls_port }}/tcp"  # DNS-over-TLS
    - "{{ adguard_dns_over_quic_port }}/udp" # DNS-over-QUIC
    - "{{ adguard_dns_over_https_port }}/tcp" # DNS-over-HTTPS
  notify: reload firewalld

- name: Enable DHCP service in firewall
  ansible.posix.firewalld:
    service: dhcp
    zone: "{{ adguard_firewall_zone }}"
    permanent: true
    immediate: true
    state: enabled
  become: true
  when: adguard_dhcp_enabled | default(false)
  notify: reload firewalld

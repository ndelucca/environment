[Service]
# Override user and group
User={{ jellyfin_user }}
Group={{ jellyfin_group }}

# Override working directory
WorkingDirectory={{ jellyfin_data_dir }}

# Clear original ExecStart
ExecStart=

# Set ExecStart with custom directories
ExecStart=/usr/bin/jellyfin \
  --datadir {{ jellyfin_data_dir }} \
  --configdir {{ jellyfin_config_dir }} \
  --logdir {{ jellyfin_log_dir }} \
  --cachedir {{ jellyfin_cache_dir }}

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/srv/jellyfin {{ jellyfin_data_dir }} {{ jellyfin_config_dir }} {{ jellyfin_cache_dir }} {{ jellyfin_log_dir }} {{ jellyfin_media_dir }}

# Restart configuration
Restart=on-failure
RestartSec=5s

---
# Handlers for AdGuard Home role

- name: daemon-reload
  ansible.builtin.systemd:
    daemon_reload: true
  become: true

- name: restart adguardhome
  ansible.builtin.systemd:
    name: "{{ adguard_service_name }}"
    state: restarted
  become: true
  listen: restart adguardhome

- name: reload systemd-resolved
  ansible.builtin.systemd:
    name: systemd-resolved
    state: reloaded
  become: true

- name: reload firewalld
  ansible.builtin.systemd:
    name: firewalld
    state: reloaded
  become: true

- name: wait for adguard
  ansible.builtin.wait_for:
    host: 127.0.0.1
    port: 53
    timeout: 10
    msg: "AdGuard DNS did not come back up"
  listen: restart adguardhome

- name: start nginx after adguard
  ansible.builtin.systemd:
    name: nginx
    state: started
  become: true
  ignore_errors: true
  listen: restart adguardhome

---
# Main entry point for AdGuard Home role

- name: Include preflight checks
  ansible.builtin.import_tasks: preflight.yml
  tags: ['adguard', 'preflight']

- name: Handle systemd-resolved conflicts
  ansible.builtin.import_tasks: systemd-resolved.yml
  tags: ['adguard', 'systemd-resolved']
  when: adguard_disable_systemd_resolved_stub | bool

- name: Install AdGuard Home binary
  ansible.builtin.import_tasks: install.yml
  tags: ['adguard', 'install']

- name: Configure AdGuard Home application
  ansible.builtin.import_tasks: configure.yml
  tags: ['adguard', 'configure']
  when: adguard_configure_app | bool

- name: Configure systemd service
  ansible.builtin.import_tasks: service.yml
  tags: ['adguard', 'service']

- name: Configure firewall
  ansible.builtin.import_tasks: firewall.yml
  tags: ['adguard', 'firewall']
  when: firewall_enabled | default(true)

- name: Configure SELinux
  ansible.builtin.import_tasks: selinux.yml
  tags: ['adguard', 'selinux']
  when: adguard_manage_selinux | bool
